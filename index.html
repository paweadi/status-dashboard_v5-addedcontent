
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Status Dashboard – Markel Services</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* === Theme (self-contained) === */
    :root {
      --bg:#0b1220; --fg:#e6eefc; --muted:#9aa6bd; --card:#0f172a;
      --row: rgba(255,255,255,.06); --border: rgba(255,255,255,.08);
      --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444; --unknown:#94a3b8;
      --link:#89c7ff; --accent:#e24a3b;
    }
    * { box-sizing:border-box; }
    body { background:var(--bg); color:var(--fg); font:14px/1.5 system-ui, Segoe UI, Roboto, Arial, sans-serif; margin:24px; }
    h1,h2 { margin:0 0 10px; }
    .meta { color:var(--muted); margin:6px 0 16px; }

    /* Table */
    table { width:100%; border-collapse:collapse; background:var(--card); border-radius:12px; overflow:hidden; }
    thead th { text-align:left; padding:12px 14px; color:var(--muted); border-bottom:1px solid var(--row); }
    tbody td { padding:12px 14px; border-bottom:1px solid var(--row); vertical-align:top; }
    tbody tr:last-child td { border-bottom:none; }

    /* Links */
    a { color:var(--link); text-decoration:none; border-bottom:1px dashed rgba(137,199,255,.35); }
    a:hover { text-decoration:underline; }

    /* Status badges */
    .badge { display:inline-block; padding:3px 10px; border-radius:999px; font-weight:600; font-size:12px; letter-spacing:.1px; }
    .badge.ok      { background:#16a34a;  color:#ffffff; border:1px solid #0f6a37; }
    .badge.warn    { background:#b45309; color:#ffffff; border:1px solid #92400e; }
    .badge.bad     { background:#dc2626;  color:#ffffff; border:1px solid #b91c1c; }
    .badge.unknown { background:rgba(148,163,184,.18);color:#e2e8f0; border:1px solid rgba(148,163,184,.35); }

    /* Divider between table and contact card */
    .section-divider { height:1px; background:var(--row); margin:16px 0; border-radius:1px; }

    /* Contact Service Management – styled like table */
    .contact-card{
      background:var(--card); color:var(--fg);
      border:1px solid var(--border); border-radius:12px;
      padding:16px; margin-top:16px;
    }
    .contact-header{ display:flex; align-items:center; gap:10px; margin-bottom:10px; }
    .contact-header h2{ font-size:16px; font-weight:600; margin:0; }
    .contact-icon{ flex:0 0 auto; line-height:0; }
    .contact-content{ display:grid; gap:8px; }
    .contact-list{ list-style:none; margin:0; padding:0; display:grid; gap:8px; }
    .contact-list li{ padding:10px 12px; border:1px solid var(--row); border-radius:10px; background:rgba(255,255,255,.03); }
    .label{ font-weight:600; margin-right:6px; }
    .tel { color:#ff8a75; text-decoration:none; border-bottom:1px dashed rgba(255,138,117,.35); }
    .tel:hover{ text-decoration:underline; }
    .dial-note{ color:#ff8a75; }
    .muted{ color:var(--muted); margin:4px 0 0; }
    .sn-link{ color:var(--link); text-decoration:none; border-bottom:1px dashed rgba(137,199,255,.35); }
    .sn-link:hover{ text-decoration:underline; }

    @media (max-width:560px){
      body{ margin:16px; }
      .contact-card{ padding:14px; }
      .contact-list li{ padding:8px 10px; }
    }
  </style>
</head>
<body>
  <h1>Status Dashboard – Markel Services</h1>
  <p class="meta">Auto-refresh: 60s • Last updated: <span id="lastUpdated">—</span></p>

  <!-- Table rendered from status.json -->
  <table id="statusTable" aria-live="polite">
    <thead>
      <tr>
        <th>Service</th>
        <th>Status</th>
        <th>Description</th>
        <th>Source</th>
      </tr>
    </thead>
    <tbody><!-- rows inserted by JS --></tbody>
  </table>

  <div class="section-divider" role="presentation"></div>

  <!-- Contact Service Management -->
  <section id="contact-sm" class="contact-card" aria-labelledby="csm-title">
    <div class="contact-header">
      <div class="contact-icon" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="22" height="22" role="img" focusable="false" aria-hidden="true">
          <circle cx="12" cy="12" r="12" fill="var(--accent)"></circle>
          <path d="M16.54 15.3l-1.28 1.28a2 2 0 0 1-2.23.43c-1.2-.5-2.8-1.7-4.19-3.09S6.25 11.1 5.76 9.9a2 2 0 0 1 .43-2.23L7.47 6.4a.8.8 0 0 1 1.15.07l1.2 1.48a1 1 0 0 1-.1 1.35l-.7.7c.47.87 1.26 1.86 2.24 2.84s1.97 1.77 2.84 2.24l.7-.7a 1 1 0 0 1 1.35-.1l1.48 1.2a.8.8 0 0 1 .07 1.15z" fill="#fff"></path>
        </svg>
      </div>
      <h2 id="csm-title">Contact Service Management</h2>
    </div>

    <div class="contact-content">
      <ul class="contact-list">
        <li>
          <span class="label">US and Bermuda:</span>
          <a class="tel" href="tel:+18045273843">+1 804 527 3843</a>
          <span class="dial-note"> (To dial from UK:
            <a class="tel" href="tel:+18045273843">001 804 527 3843</a>)
          </span>
        </li>

        <li>
          <span class="label">Markel International:</span>
          <a class="tel" href="tel:+442079536782">+44 (0)207 953 6782</a>
          <span class="dial-note"> (To dial from US:
            <a class="tel" href="tel:+442079536782">011 44 207 953 6782</a>)
          </span>
        </li>
      </ul>

      <p class="muted">Please note Service Management email is not monitored</p>
      <p>Web: <a class="sn-link" href="https://markel.service-now.com/sp" target="_blank" rel="noopener noreferrer">https://markel.service-now.com/sp</a></p>
    </div>
  </section>

  <script>
    const REFRESH_MS = 60000;
    const severityOrder = { Major: 0, Minor: 1, Operational: 2, Unknown: 3 };

    function badgeFor(status) {
      const s = (status || 'Unknown').toLowerCase();
      if (s === 'operational') return { cls:'ok', label:'Operational' };
      if (s === 'minor')       return { cls:'warn', label:'Minor' };
      if (s === 'major')       return { cls:'bad', label:'Major' };
      return { cls:'unknown', label:'Unknown' };
    }

    function escapeHtml(s='') {
      return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    }

    /** Proper hyperlink generator with href/target/rel */
    function linkHTML(url, text){
      if(!url) return '';
      const href = String(url).trim();
      const label = escapeHtml(text || url);
      return `<a href="${href}" target="_blank" rel="noopener noreferrer">${label}</a>`;
    }

    function readableSource(url, fallback) {
      try { return fallback || new URL(url).hostname; } catch { return fallback || url || ''; }
    }

    function rowHTML(svc){
      const { cls, label } = badgeFor(svc.status);
      const desc = svc.description || (svc.status === 'Operational' ? 'All systems operational' : 'Status unknown');
      const src = (svc.source || '').trim();
      const srcText = readableSource(src, svc.name);

      return `
        <tr>
          <td>${escapeHtml(svc.name || '')}</td>
          <td><span class="badge ${cls}">${label}</span></td>
          <td>${escapeHtml(desc)}</td>
          <td>${linkHTML(src, srcText)}</td>
        </tr>
      `;
    }

    async function refresh(){
      const res = await fetch('status.json?' + Date.now(), { cache:'no-store' });
      const data = await res.json();
      const list = Array.isArray(data.services) ? data.services.slice() : [];

      // Sort: Major -> Minor -> Operational -> Unknown, then A–Z
      list.sort((a,b) =>
        (severityOrder[a.status] - severityOrder[b.status]) ||
        (a.name || '').localeCompare(b.name || '')
      );

      document.querySelector('#statusTable tbody').innerHTML = list.map(rowHTML).join('');
      document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
    }

    refresh().catch(console.error);
    setInterval(() => refresh().catch(console.error), REFRESH_MS);
  </script>
</body>
</html>
